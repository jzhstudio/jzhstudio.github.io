# HTTPServlet

@(java学习笔记)

>servlet在最开始设计的时候是非常有野心的，他不只是想要兼容http协议，还想要兼容其他的协议。
>所以ServletRequest是一个对象，也可以说是所有请求的父类。他能够兼容所有请求。

如图所示：![Alt text](./1469070996575.png)
要知道子类的功能比父类更加的强大。
>在我们开发项目的时候，基本上都是基于HTTP协议的，而且服务器在service方法中传给我的ServletRequest对象，实际上就是HttpServletRequest对象。ServletResponse同理。所以我们把request和response强转成HTTP的。
### Requset对象中封装了什么东西?
>http请求协议中的四部分都封装在了request中。
### post请求怎么发？
>只能用表单才能发出去。
>例如：
>![Alt text](./1469072975687.png)
>除此之外，其余的都是get请求。
**GenericServlet继承自servlet**
**HttpServlet继承自GenericServlet**
**他们都是为了方便用户，一级级进行优化过来的，因为在以后的项目中我们常用的就是HttpServlet，之所以要介绍他的父类，是让我们更好的了解底层的原理**
>1. 下面的第一段代码是HttpServlet继承自GenericServlet的service方法。
>2. 在此方法中把父类中的req和res进行强转，强制转换为HttpServlet格式，也就是子类的格式。
>3. 然后在调用HttpServlet中的service方法。
```
	public void service(ServletRequest req, ServletResponse res)
		throws ServletException, IOException
	{
		HttpServletRequest request;
		HttpServletResponse response;
		try
		{
			request = (HttpServletRequest)req;
			response = (HttpServletResponse)res;
		}
		catch (ClassCastException e)
		{
			throw new ServletException("non-HTTP request or response");
		}
		service(request, response);
	}
```
### HttpServlet中的service方法
```
	protected void service(HttpServletRequest req, HttpServletResponse resp)
		throws ServletException, IOException
	{
		String method = req.getMethod();
		if (method.equals("GET"))
		{
			long lastModified = getLastModified(req);
			if (lastModified == -1L)
			{
				doGet(req, resp);
			} else
			{
				long ifModifiedSince = req.getDateHeader("If-Modified-Since");
				if (ifModifiedSince < (lastModified / 1000L) * 1000L)
				{
					maybeSetLastModified(resp, lastModified);
					doGet(req, resp);
				} else
				{
					resp.setStatus(304);
				}
			}
		} else
		if (method.equals("HEAD"))
		{
			long lastModified = getLastModified(req);
			maybeSetLastModified(resp, lastModified);
			doHead(req, resp);
		} else
		if (method.equals("POST"))
			doPost(req, resp);
		else
		if (method.equals("PUT"))
			doPut(req, resp);
		else
		if (method.equals("DELETE"))
			doDelete(req, resp);
		else
		if (method.equals("OPTIONS"))
			doOptions(req, resp);
		else
		if (method.equals("TRACE"))
		{
			doTrace(req, resp);
		} else
		{
			String errMsg = lStrings.getString("http.method_not_implemented");
			Object errArgs[] = new Object[1];
			errArgs[0] = method;
			errMsg = MessageFormat.format(errMsg, errArgs);
			resp.sendError(501, errMsg);
		}
	}
```